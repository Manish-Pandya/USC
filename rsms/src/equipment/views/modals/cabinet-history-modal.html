<div cg-busy="{promise:loading, message:'Loading...', backdrop:true,templateUrl:'../client-side-framework/busy-templates/full-page-busy.html'}"></div>

<div class="modal-header" style="padding:0;">
    <h2 style="padding:5px; background:#428642; color:white">Certification History For {{modalData.BioSafetyCabinet.Serial_number}} ({{modalData.BioSafetyCabinet.SelectedInspection.Room.Building_name}} {{modalData.BioSafetyCabinet.SelectedInspection.Room.Name}})</h2>
</div>

<div class="modal-body inspections wide-modal" style="overflow-y:visible !important;">
    <table class="table table-striped table-bordered" >
        <tr class="table-header">
            <th>TYPE</th>
            <th>MANUFACTURER</th>
            <th>MODEL</th>
            <th>SERIAL #</th>
        </tr>
        <tr class="table-header">
            <td>
                {{cabinet.Type}}
            </td>

            <td>
                {{cabinet.Make}}
            </td>
            <td>
                {{cabinet.Model}}
            </td>
            <td>
                {{cabinet.Serial_number}}
            </td>
        </tr>
    </table>
    <table class="table table-striped table-bordered">
        <tr class="table-header">
            <th>
                BUILDING<br>
            </th>
            <th>
                ROOM
            </th>
            <th>CERT-DATE</th>
            <th>
                PI / CONTACT
            </th>
            <th>
                STATUS
            </th>
            <th>
                REPORT/<br />Quote
            </th>
            <th>COMMENTS</th>
        </tr>
        <tr class="table-header" ng-repeat="inspection in cabinet.EquipmentInspections">
            <td>
               {{inspection.Room.Building.Alias || inspection.Room.Building.Name}}
                   
            </td>
            <td>
               {{inspection.Room.Name}}
            </td>
            <td>
                <span ng-class="{'red': inspection.Status == constants.EQUIPMENT.STATUS.FAIL || inspection.Status == constants.EQUIPMENT.STATUS.OVERDUE || inspection.Is_uncertified,
                                        'yellow': inspection.Status == constants.EQUIPMENT.STATUS.PENDING || inspection.Status == constants.EQUIPMENT.STATUS.NEW,
                                        'green': inspection.Status == constants.EQUIPMENT.STATUS.PASS }">
                    <span class="bold" ng-if="inspection.Status == constants.EQUIPMENT.STATUS.FAIL">FAILED</span>
                    <span class="bold" ng-if="inspection.Status == constants.EQUIPMENT.STATUS.PENDING">DUE:</span>
                    <span class="bold" ng-if="inspection.Status == constants.EQUIPMENT.STATUS.NEW">NO CERTIFICATION RECORD</span>
                    <span class="bold green" ng-if="inspection.Status == constants.EQUIPMENT.STATUS.PASS">PASSED</span>
                    {{inspection.Certification_date || inspection.Fail_date || inspection.Due_date | dateToIso}}
                </span>
            </td>
            <td>
                <span><a ng-class="{'red':!pi.Is_active}" style="display: block;padding: 3px 0;" ng-click="openPiInfoModal(pi)" ng-repeat="pi in pis = (inspection.PrincipalInvestigators | activeWhenInspected:inspection)">{{pi.User.Name}}<br ng-if="!$last"></a></span>
                <span ng-if="!pis.length" class="red">Unsassigned</span>
            </td>
            <td>
                <span ng-class="{'red': inspection.Status == constants.EQUIPMENT.STATUS.FAIL || inspection.Status == constants.EQUIPMENT.STATUS.OVERDUE || inspection.Is_uncertified,
                                        'yellow': inspection.Status == constants.EQUIPMENT.STATUS.PENDING || inspection.Status == constants.EQUIPMENT.STATUS.NEW,
                                        'green': inspection.Status == constants.EQUIPMENT.STATUS.PASS }">
                    <span class="bold" ng-if="inspection.Is_uncertified && inspection.Status != constants.EQUIPMENT.STATUS.FAIL">FAILED ON:<br />{{inspection.Due_date | dateToISO}}</span>
                    <span class="bold" ng-if="inspection.Status == constants.EQUIPMENT.STATUS.FAIL">FAIL</span>
                    <span class="bold" ng-if="inspection.Status == constants.EQUIPMENT.STATUS.OVERDUE">OVERDUE:<br />{{inspection.Due_date | dateToISO}}</span>
                    <span class="bold" ng-if="inspection.Status == constants.EQUIPMENT.STATUS.PENDING">DUE: <br />{{inspection.Due_date | dateToISO}}</span>
                    <span class="bold" ng-if="inspection.Status == constants.EQUIPMENT.STATUS.NEW">NO CERTIFICATION RECORD</span>
                    <span class="bold green" ng-if="inspection.Status == constants.EQUIPMENT.STATUS.PASS">PASS</span>
                </span>
            </td>
            <td>
                {{cabinet.Model}}
            </td>
            <td>
                <span ng-bind-html="getMostRecentComment(cabinet, inspection)"></span>
            </td>
        </tr>
    </table>
</div>

<div class="modal-footer">
    <a class="btn btn-large left" ng-click="close()"><i class="icon-cancel-2"></i>Close</a>
</div>
