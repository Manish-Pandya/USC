<h1 class="alert alert-danger" ng-if="error">{{error}}</h1>
<div class="loading" ng-if="loading">
    <i class="icon-spinnery-dealie spinner large"></i>
    <span>Getting Buildings...</span>
</div>
<table class="userList table table-striped table-hover piTable table-bordered locationTable sticky-headers" ng-if="buildings && !loading" watch="filtered.length">
    <thead>
        <tr class="blueBg sticky-action-bar">
            <th colspan="5" class="blueBg">
                <h1 class="blueBg">Buildings</h1>
                <div class="btn-group" style="margin:-22px 0 0 30px">
                    <a ng-if="userCanEditBuilding" class="btn-large btn" ng-click="addBuilding()" style="padding:10px; margin-left:5px;"><i class="icon-plus-2" style="margin: 3px 13px 0 0 !important;font-size: 21px;"></i>Add Building</a>
                </div>
                <h2 class="blueBg" style="float:right; margin-top:8"><span class="bold underline">{{filtered.length}}</span> Building Displayed</h2>
            </th>
        </tr>
        <tr class="sticky-header-bar">
            <th clas="temp">Edit</th>
            <th>
                <a>Building</a><br>
                <input class="span2" ng-model="search.building" placeholder="Filter by Building" />
            </th>
            <th>
                <a>Alias</a><br>
                <input class="span2" ng-model="search.alias" placeholder="Filter by Alias" />
            </th>
            <th>
                Physical Address
            </th>
            <th style="width:15.4%;">
                <a>Campus</a><br>
                <input class="span2" ng-model="search.campus" placeholder="Filter by Campus" />
            </th>
        </tr>
    </thead>

    <tbody>
        <tr ng-repeat="building in (filtered = (buildings | genericFilter:search | orderBy:['index', 'Campus.Name', 'Name']))" ng-class="{'inactive': !building.Is_active, 'new': building.isNew}">
            <td style="width:6%;">
                <button ng-disabled="!userCanEditBuilding" ng-if="!building.edit" class="edit btn btn btn-primary" ng-click="lhf.setEditState(building, buildings); editing(false);" alt="Edit" title="Edit" title="Edit"><i class="icon-pencil"></i></button>
                <button ng-disabled="!userCanEditBuilding" ng-if="building.edit" class="edit btn btn btn-primary" disabled="disabled" alt="Edit" title="Edit" title="Edit"><i class="icon-pencil"></i></button>
                <span ng-if="!building.edit">
                    <button ng-disabled="!userCanEditBuilding" class="btn btn-danger btn DeactivateeRow" ng-click="lhf.handleObjectActive(building)" ng-if="building.Is_active" alt="Deactivate" title="Deactivate"><i class="icon-remove"></i></button>
                    <button ng-disabled="!userCanEditBuilding" class="btn btn-success btn DeactivateeRow" ng-click="lhf.handleObjectActive(building)" ng-if="!building.Is_active"><i class="icon-checkmark"></i></button>
                    <i class="icon-spinnery-dealie spinner small" style="position:absolute;margin: 3px;" ng-if="building.IsDirty"></i>
                </span>

                <span ng-if="building.edit">
                    <button ng-disabled="!userCanEditBuilding" class="btn btn-danger btn DeactivateeRow" disabled="disabled" ng-if="building.Is_active" alt="Deactivate" title="Deactivate"><i class="icon-remove"></i></button>
                    <button ng-disabled="!userCanEditBuilding" class="btn btn-success btn DeactivateeRow" disabled="disabled" ng-if="!building.Is_active"><i class="icon-checkmark"></i></button>
                </span>

            </td>

            <td style="width:15%">
                <span ng-if="!building.edit" once-text="building.Name"></span>
                <input ng-if="building.edit" ng-model="copy.Name" ng-change="lhf.editing(true)">
            </td>
            <td style="width:15%">
                <span ng-if="!building.edit" once-text="building.Alias"></span>
                <input ng-if="building.edit" ng-model="copy.Alias" ng-change="lhf.editing(true)">
            </td>

            <td style="width:15%">
                <span ng-if="!building.edit" once-text="building.Physical_address"></span>
                <input ng-if="building.edit" ng-model="copy.Physical_address" ng-change="lhf.editing(true)">
            </td>
            <td style="width:15%">
                <span ng-if="building.edit">
                    <select ng-model="copy.Campus_id" ng-options="campus.Key_id as campus.Name for campus in campuses">
                        <option value="" style="display:none"></option>
                    </select>
                    <span class="absoluteBtns" style="margin-top:0">
                        <a ng-if="copy.Name && copy.Campus_id" class="btn-success btn left" ng-click="saveBuilding(building); lhf.editing(false);"><i class="icon-checkmark"></i>Save</a>
                        <a ng-if="!copy.Name || !copy.Campus_id" class="btn-success btn left" disabled="disabled"><i class="icon-checkmark"></i>Save</a>
                        <a class="btn-danger btn left" ng-click="lhf.cancelEdit(building, buildings); lhf.editing(false);"><i class="icon-cancel-2"></i>Cancel</a>
                        <i class="icon-spinnery-dealie spinner small" style="position:absolute;margin: 3px;" ng-if="building.IsDirty"></i>
                    </span>
                </span>
                <span ng-if="!building.edit" once-text="building.Campus.Name"></span>
            </td>
        </tr>
    </tbody>
</table>
