<div cg-busy="{promise:PickupSaving,message:'Saving Pickup', backdrop:true,templateUrl:'views/busy-templates/full-page-busy.html'}"></div>
<div cg-busy="{promise:pickupsPromise,message:'Loading Pickups', backdrop:true,templateUrl:'views/busy-templates/full-page-busy.html'}"></div>
<div cg-busy="{promise:ScintVialCollectionSaving,message:'Saving Pickup', backdrop:true,templateUrl:'views/busy-templates/full-page-busy.html'}"></div>
<div cg-busy="{promise:WasteBagSaving,message:'Saving Pickup', backdrop:true,templateUrl:'views/busy-templates/full-page-busy.html'}"></div>
<div cg-busy="{promise:CarboyUseCycleSaving,message:'Saving Pickup', backdrop:true,templateUrl:'views/busy-templates/full-page-busy.html'}"></div>
<div class="spacer" style="height:70px;"></div>

<ul class="nav nav-pills" style="margin:20px 0 0">
    <li ng-class="{'active':!pickupsFilter.showAll}"><a ng-click="pickupsFilter.showAll = false;">Current Pickups</a></li>
    <li ng-class="{'active':pickupsFilter.showAll}"><a ng-click="pickupsFilter.showAll = true;">All Pickups</a></li>
</ul>
<div class="card super pickups pickup-collection" ng-if="!activePickups || !activePickups.length">
    <h1 class="card-header accordion-header">No PIs have requested pickups at this time.</h1>
</div>
<div>
    <div class="card super pickups pickup-collection admin" ng-repeat="pickup in activePickups = (pickups | activePickups:pickupsFilter.showAll) track by $index" >
        <div>
            <h1 ng-class="{'no-underline':!pickup.show}" class="card-header accordion-header" ng-click="pickup.show = !pickup.show">
                <!--<span class="pull-left">-->
                <i class="icon-box-remove"></i>{{pickup.PrincipalInvestigator.User.Name}} requested a pickup on {{pickup.Requested_date | dateToISO}}
                <!--</span>
                        <i class="pull-right" ng-class="{'icon-minus':pickup.show,'icon-plus':!pickup.show}"></i>
                -->
            </h1>

            <div ng-show="pickup.show" class="print-always pickup-form">
                <h3>
                    Pickup Status:<label class="checkbox print">
                        <input type="checkbox" ng-true-value="yes" ng-checked="pickup.Status == Constants.PICKUP.STATUS.PICKED_UP || pickup.Status == Constants.PICKUP.STATUS.AT_RSO" />
                        <span class="metro-checkbox">Picked Up</span>
                    </label>
                </h3>
                <a class="btn btn-large no-print btn-info" ng-click="setStatusAndSave(pickup,Constants.PICKUP.STATUS.PICKED_UP, (pickup.Status == Constants.PICKUP.STATUS.PICKED_UP || pickup.Status == Constants.PICKUP.STATUS.AT_RSO))">
                    <label class="checkbox">
                        <input type="checkbox" ng-true-value="yes" ng-checked="pickup.Status == Constants.PICKUP.STATUS.PICKED_UP || pickup.Status == Constants.PICKUP.STATUS.AT_RSO" />
                        <span class="metro-checkbox">Picked Up</span>
                    </label>
                </a>
                <a class="btn btn-large no-print btn-success" ng-click="setStatusAndSave(pickup, Constants.PICKUP.STATUS.AT_RSO, (pickup.Status == Constants.PICKUP.STATUS.AT_RSO))">
                    <label class="checkbox">
                        <input type="checkbox" ng-true-value="yes" ng-checked="pickup.Status == Constants.PICKUP.STATUS.AT_RSO" />
                        <span class="metro-checkbox">At RSO</span>
                    </label>
                </a>

                <button ng-click="selectWaste(pickup.Waste_bags, pickup, pickup.PrincipalInvestigator )" class="btn btn-primary left">
                    <i class="icon-pencil primary"></i>
                    Choose Usages
                </button>
                <h2 ng-if="pickup.Status == Constants.PICKUP.STATUS.PICKED_UP || pickup.Status == Constants.PICKUP.STATUS.AT_RSO" style="display:inline">
                    Picked up 
                    <span ng-if="!pickup.editDate">{{pickup.Pickup_date | dateToISO:pickup:'Pickup_date':true}} <i class="icon-pencil primary" ng-click="pickup.editDate = true" style="margin:4px 0px 0 0"></i></span>
                    <span ng-if="pickup.editDate"><input ng-model="pickup.view_Pickup_date" style="width:90px" /> <i class="icon-checkmark success" ng-click="setPickupDate(pickup)" style="margin:4px 6px 0 0"></i><i class="icon-cancel-2 red" ng-click="pickup.editDate = false" style="margin:4px 0 0 0"></i></span>
                </h2>

            </div>

            <div class="print-always" ng-show="pickup.show" ng-if="pickup.Waste_bags.length">
                <h3>{{pickup.Waste_bags.length}} Waste Bag<span ng-if="pickup.Waste_bags.length!=1">s</span></h3>
                <div class="fake-table" ng-if="pickup.Waste_bags.length">
                    <div class="table-row" ng-repeat="bag in pickup.Waste_bags" ng-class="{'inactive':bag.removed}">
                        <div class="button-cell no-print">
                            <a ng-if="!bag.removed" class="btn btn-danger left" ng-click="af.adminRemoveFromPickup(bag)"><i class="icon-remove"></i>Leave In Lab</a>
                            <a ng-if="bag.removed" class="btn btn-success left" ng-click="af.adminAddToPickup(bag, pickup)"><i class="icon-plus-2"></i>Pickup</a>
                        </div>
                        <div class="pickup-item-contents">
                            <p class="pickup-item-contents">Contents: <span ng-if="!bag.Contents.length">No activity in bag</span><span ng-repeat="content in bag.Contents">{{content.Curie_level}}mCi of {{content.Isotope_name}}<span ng-if="!$last">, </span></span></p>
                            <div class="pickup-comments" style="padding:0;">
                                <span ng-if="bag.Comments && !bag.edit">Comments: {{bag.Comments}}<i ng-click="af.createCopy(bag)" class="icon-pencil primary"></i></span>
                                <span ng-if="!bag.Comments && !bag.edit">Add Comment:<a class="btn btn-success btn-mini" ng-click="af.createCopy(bag)"><i class="icon-plus-2 success"></i></a></span>
                                <div class="control-group" ng-if="bag.edit">
                                    <label class="control-label">Comments</label>
                                    <div class="controls">
                                        <textarea style="width:100%" ng-model="WasteBagCopy.Comments" rows="2" maxlength="255"></textarea>
                                    </div>
                                    <button class="btn-success btn left" ng-click="af.saveWasteBag(bag, WasteBagCopy);"><i class="icon-checkmark"></i></button>
                                    <button class="btn-danger btn left" ng-click="af.cancelEdit(bag)"><i class="icon-cancel-2"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="print-always" ng-show="pickup.show" ng-if="pickup.Scint_vial_collections.length">
                <h3>{{pickup.Scint_vial_trays}} Scint Vial Trays:</h3>
                <div class="fake-table" ng-if="pickup.Scint_vial_collections.length">
                    <div ng-repeat="collection in pickup.Scint_vial_collections" ng-class="{'inactive':collection.removed}" class="table-row">
                        <div class="button-cell no-print">
                            <a ng-if="!collection.removed" class="btn btn-danger left" ng-click="af.adminRemoveFromPickup(collection)"><i class="icon-remove"></i>Leave In Lab</a>
                            <a ng-if="collection.removed" class="btn btn-success left" ng-click="af.adminAddToPickup(collection, pickup)"><i class="icon-plus-2"></i>Pick up</a>
                        </div>
                        <div class="pickup-item-contents">
                            Contents: <span ng-if="!collection.Contents.length">No Activity</span><span ng-repeat="content in collection.Contents">{{content.Curie_level}}mCi of {{content.Isotope_name}}<span ng-if="!$last">, </span></span>
                            <div class="pickup-comments" style="padding:0 !important;">
                                <span ng-if="collection.Comments && !collection.edit">Comments: {{collection.Comments}}<i ng-click="af.createCopy(collection)" class="icon-pencil primary"></i></span>
                                <span ng-if="!collection.Comments && !collection.edit">Add Comment:<a class="btn btn-success btn-mini" ng-click="af.createCopy(collection)"><i class="icon-plus-2 success"></i></a></span>
                                <div class="control-group" ng-if="collection.edit">
                                    <label class="control-label">Comments</label>
                                    <div class="controls">
                                        <textarea style="width:100%" ng-model="ScintVialCollectionCopy.Comments" rows="2" maxlength="255"></textarea>
                                    </div>
                                    <button class="btn-success btn left" ng-click="af.saveSVCollection(collection, ScintVialCollectionCopy);"><i class="icon-checkmark"></i></button>
                                    <button class="btn-danger btn left" ng-click="af.cancelEdit(collection)"><i class="icon-cancel-2"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="print-always" ng-show="pickup.show" ng-if="pickup.Carboy_use_cycles.length">
                <h3>{{pickup.Carboy_use_cycles.length}} Carboy<span ng-if="pickup.Carboy_use_cycles.length>1">s</span></h3>
                <div class="fake-table" ng-if="pickup.Carboy_use_cycles.length">
                    <div class="table-row" ng-repeat="cycle in pickup.Carboy_use_cycles" ng-class="{'inactive':cycle.removed}">
                        <div class="button-cell no-print">
                            <a ng-if="!cycle.removed" class="btn btn-danger left" ng-click="af.adminRemoveFromPickup(cycle)"><i class="icon-remove"></i>Leave In Lab</a>
                            <a ng-if="cycle.removed" class="btn btn-success left" ng-click="af.adminAddToPickup(cycle, pickup)"><i class="icon-plus-2"></i>Pickup</a>
                        </div>

                        <div class="pickup-item-contents">
                            <span class="bag-date">Carboy Number {{cycle.Carboy.Carboy_number}}</span>
                            <p ng-if="cycle.Contents.length">
                                Contents: <span ng-repeat="content in cycle.Contents">{{content.Curie_level}}mCi of {{content.Isotope_name}}<span ng-if="!$last">, </span></span>
                            </p>
                            <div class="pickup-comments">
                                <span ng-if="cycle.Comments && !cycle.edit">Comments: {{cycle.Comments}}<i ng-click="af.createCopy(cycle)" class="icon-pencil primary"></i></span>
                                <span ng-if="!cycle.Comments && !cycle.edit">Add Comment:<a class="btn btn-success btn-mini" ng-click="af.createCopy(cycle)"><i class="icon-plus-2 success"></i></a></span>
                                <div class="control-group" ng-if="cycle.edit">
                                    <label class="control-label">Comments</label>
                                    <div class="controls">
                                        <textarea style="width:100%" ng-model="CarboyUseCycleCopy.Comments" rows="2" maxlength="255"></textarea>
                                    </div>
                                    <button class="btn-success btn left" ng-click="af.saveCarboyUseCycle(CarboyUseCycleCopy, cycle);"><i class="icon-checkmark"></i></button>
                                    <button class="btn-danger btn left" ng-click="af.cancelEdit(cycle)"><i class="icon-cancel-2"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="print-always" ng-show="pickup.show" ng-if="pickup.Notes">
                <h3 style="padding-bottom:10px;">Notes:<p>{{pickup.Notes}}</p></h3>
            </div>
        </div>
    </div>
</div>