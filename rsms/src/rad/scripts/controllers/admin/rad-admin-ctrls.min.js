"use strict";angular.module("00RsmsAngularOrmApp").controller("AdminPickupCtrl",function(n,t,i,r){var u=t,f=function(){u.getAllPickups().then(function(t){console.log(t);n.pickups=t;console.log(dataStore)},function(){})};n.af=u;r.pickupsPromise=u.getRadModels().then(function(){for(var i=dataStoreManager.get("Pickup"),t=0;t<i.length;t++)(i[t].Status==Constants.PICKUP.STATUS.PICKED_UP||i[t].Status==Constants.PICKUP.STATUS.REQUESTED&&i[t].Waste_bags.length||i[t].Scint_vial_collections.length||i[t].Carboy_use_cycles.length)&&(i[t].loadCarboyUseCycles(),i[t].loadWasteBags(),i[t].loadCurrentScintVialCollections());n.pickups=dataStoreManager.get("Pickup")});n.setStatusAndSave=function(n,t,i){console.log(status);console.log(i);i=!i;console.log(i);var r=dataStoreManager.createCopy(n);r.Status=i==!0?t:t==Constants.PICKUP.STATUS.PICKED_UP?null:Constants.PICKUP.STATUS.PICKED_UP;u.savePickup(n,r,!0)}}).controller("AdminPickupModalCtrl",function(n,t,i,r,u){var f=t;n.af=f;n.modalData=f.getModalData();n.modalData.SolidsContainerCopy||(n.modalData.SolidsContainerCopy={Class:"SolidsContainer",Room_id:null,Is_active:!0});n.close=function(){u.dismiss();f.deleteModalData()}});angular.module("00RsmsAngularOrmApp").filter("authsFilter",function(){return function(n,t){if(!t)return n;return n.filter(function(n){var i=!0;return t.piName&&n.PiName.toLowerCase().indexOf(t.piName.toLowerCase())==-1&&(i=!1),t.department&&(n.Departments.some(function(n){return n.Name.toLowerCase().indexOf(t.department.toLowerCase())!=-1})||(i=!1)),t.room&&(n.Rooms.some(function(n){return n.Name.toLowerCase().indexOf(t.room.toLowerCase())!=-1})||(i=!1)),t.building&&(n.Rooms.some(function(n){return n.Building.Name.toLowerCase().indexOf(t.building.toLowerCase())!=-1})||(i=!1)),i})}}).controller("AuthReportCtrl",function(n,t,i,r){var u=n.af=t,f=function(){u.getAllPIAuthorizations().then(function(t){var t,i,r;n.piAuths=[];t=_.groupBy(dataStore.PIAuthorization,"Principal_investigator_id");for(i in t)r=t[i].sort(function(n,t){return t.Approval_date-n.Approval_date||t.Amendment_number-n.Amendment_number||t.Key_id-n.Key_id})[0],n.piAuths.push(r);console.log(n.piAuths)},function(){console.log("dang!")})};r.piAuthsPromise=u.getAllPIs().then(f);console.log("AuthReportCtrl running")});angular.module("00RsmsAngularOrmApp").controller("CarboysCtrl",function(n,t,i,r,u){var f=t,e=function(){f.getAllCarboys().then(function(){n.carboys=dataStore.Carboy},function(){})};n.af=f;r.carboysPromise=f.getAllPIs().then(e);n.deactivate=function(n){var t=dataStoreManager.createCopy(n);t.Retirement_date=new Date;f.saveCarboy(n.PrincipalInvestigator,t,n)};n.openModal=function(n){var t={},i;n||(n=new window.Carboy,n.Class="Carboy");t[n.Class]=n;f.setModalData(t);i=u.open({templateUrl:"views/admin/admin-modals/carboy-modal.html",controller:"CarboysModalCtrl"})}}).controller("CarboysModalCtrl",function(n,t,i,r,u){var f=t;n.af=f;n.modalData=f.getModalData();console.log(n.modalData);n.save=function(t){f.saveCarboy(t.PrincipalInvestigator,t,n.modalData.Carboy).then(n.close)};n.close=function(){u.dismiss();dataStore.Carboy.push(n.modalData.CarboyCopy);f.deleteModalData()}});angular.module("00RsmsAngularOrmApp").controller("disposalCtrl",function(n,t,i,r,u,f){var e=t;n.af=e;n.cv=i;var s=function(){return e.getAllDrums().then(function(n){return dataStore.Drum||(dataStore.Drum=[]),u.drums=dataStore.Drum,n})},h=function(){return e.getAllWasteBags().then(function(t){dataStore.WasteBag||(dataStore.WasteBag=[]);for(var i=dataStore.WasteBag.length;i--;)dataStore.WasteBag[i].loadPickup();return n.wasteBags=dataStore.WasteBag,t})},c=function(){return e.getAllCarboyUseCycles().then(function(t){return dataStore.CarboyUseCycle||(dataStore.CarboyUseCycle=[]),n.cycles=dataStoreManager.get("CarboyUseCycle"),t})},l=function(){return e.getAllScintVialCollections().then(function(n){dataStore.ScintVialCollection||(dataStore.ScintVialCollection=[]);for(var t=dataStore.ScintVialCollection.length;t--;)dataStore.ScintVialCollection[t].loadPickup();return u.svCollections=dataStore.ScintVialCollection,n})},a=function(){return e.getAllIsotopes().then(function(n){return u.isotopes=dataStore.Isotope,n})},o=function(){return e.getAllMiscellaneousWaste().then(function(n){return u.miscWastes=dataStore.MiscellaneousWaste,n})};h().then(a).then(l).then(s).then(c).then(o);n.date=new Date;n.assignDrum=function(n){var t={},i;n&&(t[n.Class]=n);e.setModalData(t);i=f.open({templateUrl:"views/admin/admin-modals/drum-assignment.html",controller:"DrumAssignmentCtrl"})};n.drumModal=function(n){var t={},i;n&&(t[n.Class]=n);e.setModalData(t);i=f.open({templateUrl:"views/admin/admin-modals/drum-shipment.html",controller:"DrumShipCtrl"})};n.editDrum=function(n){var t={},i;n||(n=new window.Drum,n.Class="Drum");t[n.Class]=n;e.setModalData(t);i=f.open({templateUrl:"views/admin/admin-modals/drum-modal.html",controller:"DrumShipCtrl"})};n.editCycle=function(n){n.edit=!0;e.createCopy(n)};n.cancelEditCycle=function(n){n.edit=!1;u.CarboyUseCycleCopy={}};n.pour=function(n){function t(n){e.createCopy(n);e.saveCarboyUseCycle(u.CarboyUseCycleCopy,n,!0)}n.pourable?t(n):window.confirm("This carboy will not decay until "+i.dateToIso(n.Pour_allowed_date)+". Are you sure you want to pour it now?")&&t(n)};n.editReading=function(n){n.edit=!0;e.createCopy(n)};n.addReading=function(n){n.readingEdit=!0;u.CarboyReadingAmountCopy=new window.CarboyReadingAmount;u.CarboyReadingAmountCopy.Carboy_use_cycle_id=n.Key_id;u.CarboyReadingAmountCopy.edit=!0;u.CarboyReadingAmountCopy.Class="CarboyReadingAmount";n.Carboy_reading_amounts||(n.Carboy_reading_amounts=[]);n.Carboy_reading_amounts.push(u.CarboyReadingAmountCopy)};n.removeReading=function(n,t){t.edit=!0;e.createCopy(t);for(var i=0;i<n.Carboy_reading_amounts.length;i++)n.Carboy_reading_amounts[i]==t&&(e.createCopy(n),n.Carboy_reading_amounts.splice(i,1),e.saveCarboyUseCycle(u.CarboyUseCycleCopy,n))};n.getIsPastHotRoomDate=function(n){var t=new Date,r,u;return t.setHours(0,0,0,0),r=n.Hot_check_date,u=i.getDate(r).getTime(),u<t.getTime()};n.resetHotRoomDate=function(n){e.createCopy(n);u.CarboyUseCycleCopy.Hot_check_date=i.setMysqlTime(new Date);e.saveCarboyUseCycle(u.CarboyUseCycleCopy,n)};n.getDateRead=function(n){return n.Date_read?i.dateToIso(n.Date_read):i.dateToIso(i.setMysqlTime(new Date))};n.openModal=function(n){var t={},i;n||(n=new window.MiscellaneousWaste,n.Class="MiscellaneousWaste");t[n.Class]=n;e.setModalData(t);i=f.open({templateUrl:"views/admin/admin-modals/misc-waste-modal.html",controller:"MiscWasteModalCtrl"});i.result.then(function(){o()})}}).controller("DrumAssignmentCtrl",["$scope","$rootScope","$modalInstance","actionFunctionsFactory","convenienceMethods",function(n,t,i,r){var u=r,f;n.af=u;n.modalData=u.getModalData();n.saveWasteBag=function(i,r){n.close();t.saving=u.saveWasteBag(i,r).then(f)};n.saveCarboyUseCycle=function(i,r){n.close();t.saving=u.saveCarboyUseCycle(r,i).then(f)};n.saveSVCollection=function(i,r){n.close();t.saving=u.saveSVCollection(i,r).then(f)};f=function(n){var t=dataStoreManager.getById("Drum",n.Drum_id);u.replaceDrum(t).then(function(){return t})};n.close=function(){u.deleteModalData();i.dismiss()}}]).controller("DrumShipCtrl",["$scope","$rootScope","$modalInstance","actionFunctionsFactory","convenienceMethods",function(n,t,i,r,u){var f=r;n.af=f;n.modalData=f.getModalData();n.shipDrum=function(i,r){r.Date_destroyed=u.setMysqlTime(u.getDate(r.view_Date_destroyed));t.saving=f.saveDrum(i,r);n.close()};n.saveDrum=function(i,r){t.saving=f.saveDrum(i,r);n.close()};n.close=function(){f.deleteModalData();i.dismiss()}}]).controller("drumDetailCtrl",function(n,t,i,r,u){var f=n.af=t,e=function(t){return f.getAllDrums().then(function(){return dataStore.Drum||(dataStore.Drum=[]),n.drum=dataStoreManager.getById("Drum",t),n.drum.loadDrumWipeTest(),n.drum})};u.loading=e(r.drumId);n.editDrumWipeTest=function(n,t){u.DrumWipeTestCopy={};t?f.createCopy(t):(u.DrumWipeTestCopy=new window.DrumWipeTest,u.DrumWipeTestCopy.Drum_id=n.Key_id,u.DrumWipeTestCopy.Class="DrumWipeTest",u.DrumWipeTestCopy.Is_active=!0);n.Creating_wipe=!0};n.cancelDrumWipeTestEdit=function(n){n.Creating_wipe=!1;u.DrumWipeTestCopy={}};n.cancelDrumWipeEdit=function(n,t){t.edit=!1;u.DrumWipeTestCopy={}};n.editDrumWipe=function(n,t){n.Drum_wipes||(n.Drum_wipes=[]);u.DrumWipeCopy={};for(var i=n.Drum_wipes.length;i--;)n.Drum_wipes[i].edit=!1;t?(t.edit=!0,f.createCopy(t)):(u.DrumWipeCopy=new window.DrumWipe,u.DrumWipeCopy.Drum_wipe_test_id=n.Key_id,u.DrumWipeCopy.Class="DrumWipe",u.DrumWipeCopy.edit=!0,u.DrumWipeCopy.Is_active=!0,n.Drum_wipes.unshift(u.DrumWipeCopy))}}).controller("MiscWasteModalCtrl",["$scope","$rootScope","$modalInstance","actionFunctionsFactory","convenienceMethods",function(n,t,i,r){var f=r,u,e;n.af=f;u=n.modalData=f.getModalData();e=new ParcelUseAmount;u.MiscellaneousWasteCopy&&(!u.MiscellaneousWasteCopy.Parcel_use_amountss||!u.MiscellaneousWasteCopy.Parcel_use_amounts.length>0)?e.Miscellaneous_waste_id==u.MiscellaneousWasteCopy||null:angular.extend(e,u.MiscellaneousWaste.Parcel_use_amounts[0]);u.MiscellaneousWasteCopy.Parcel_use_amounts=[e];n.save=function(n,t){console.log(n,t);f.saveMiscellaneousWaste(n,t).then(function(){i.close(t)})};n.close=function(){f.deleteModalData();i.dismiss()}}]);angular.module("00RsmsAngularOrmApp").controller("InventoriesCtrl",function(n,t,i,r){var u=t,f=function(){u.getQuartleryInventory(1).then(function(){n.pi_inventory=dataStoreManager.getById("PIQuarterlyInventory",1)})};n.getAllPIs=u.getAllPIs().then(function(t){n.PIs=t;return},function(){return n.error="Couldn't get the PIs",!1});n.af=u;n.inventoryPromise=u.getMostRecentInventory().then(function(t){n.inventory=t;console.log(t)},function(){});r.current.name=="radmin-quarterly-inventory"&&f();n.getInventoriesByPiId=function(t){n.piInventoriesPromise=u.getInventoriesByPiId(t).then(function(t){console.log(t);n.piInventories=t})};n.createInventory=function(t,i){u.createQuarterlyInventory(t,i).then(function(t){n.inventory=t;console.log(t)},function(){})}});angular.module("00RsmsAngularOrmApp").controller("IsotopeCtrl",function(n,t,i,r,u){var f=t,e=function(){f.getAllIsotopes().then(function(){n.isotopes=dataStore.Isotope},function(){})};n.af=f;r.isotopesPromise=e();n.deactivate=function(n){var t=dataStoreManager.createCopy(n);t.Is_active=!t.Is_active;f.saveCarboy(t,n)};n.openModal=function(n){var t={},i;n||(n=new window.Carboy,n.Class="Carboy");t[n.Class]=n;f.setModalData(t);i=u.open({templateUrl:"views/admin/admin-modals/isotope-modal.html",controller:"IsotopeModalCtrl"})}}).controller("IsotopeModalCtrl",function(n,t,i,r,u){var f=t;n.af=f;n.modalData=f.getModalData();f.getModalData().Isotope||(n.modalData.IsotopeCopy=new window.Isotope,n.modalData.IsotopeCopy.Class="Isotope");console.log(n.modalData);n.save=function(t,i){f.saveIsotope(t,i).then(n.close)};n.close=function(){u.dismiss();f.deleteModalData()}});angular.module("00RsmsAngularOrmApp").controller("AllOrdersCtrl",function(n,t,i,r,u,f){var e=t;n.af=e;r.parcelPromise=e.getAllPIs().then(function(){for(var t=dataStore.PrincipalInvestigator.length;t--;)dataStore.PrincipalInvestigator[t].loadActiveParcels(),dataStore.PrincipalInvestigator[t].loadPurchaseOrders(),dataStore.PrincipalInvestigator[t].loadPIAuthorizations();n.pis=dataStore.PrincipalInvestigator});n.deactivate=function(n){var t=dataStoreManager.createCopy(n);t.Retirement_date=new Date;e.saveCarboy(n.PrincipalInvestigator,t,n)};n.openModal=function(n,t){var i={},r;n||(n=new window.Parcel,n.Class="Parcel");i.pi=t;i[n.Class]=n;console.log(i);e.setModalData(i);r=u.open({templateUrl:"views/admin/admin-modals/parcel-modal.html",controller:"PiDetailModalCtrl"})};n.openWipeTestModal=function(n,t){var i={},r;i.pi=t;i.Parcel=n;e.setModalData(i);r=u.open({templateUrl:"views/admin/admin-modals/package-wipe-test.html",controller:"WipeTestModalCtrl"})};n.updateParcelStatus=function(n,t,i){var r=new window.Parcel;angular.extend(r,t);r.Status=i;r.Arrival_date=f.setMysqlTime(new Date);e.saveParcel(r,t,n)}});angular.module("00RsmsAngularOrmApp").controller("PiDetailCtrl",function(n,t,i,r,u,f){var e=t,o;n.af=e;o=function(){return t.getRadPIById(i.pi).then(function(n){return n.loadUser(),n.loadRooms(),n.loadActiveParcels(),n.loadPurchaseOrders(),n.loadPIAuthorizations(),n.loadCarboyUseCycles(),n.loadSolidsContainers(),r.pi=n,n},function(){})};r.radPromise=e.getRadModels().then(o);n.onSelectPi=function(n){$state.go(".pi-detail",{pi:n.Key_id})};n.selectAmendement=function(t){console.log(t);n.mappedAmendments.forEach(function(i){if(i.weight==t){n.selectedPiAuth=i;return}})};n.openModal=function(t,i,f){var o={},s;o.pi=n.pi;o.isAmendment=f||!1;i&&(o[i.Class]=i);e.setModalData(o);s=u.open({templateUrl:t+".html",controller:"PiDetailModalCtrl"});s.result.then(function(){n.getHighestAmendmentNumber(r.pi.Pi_authorization)})};n.getHighestAmendmentNumber=function(t){var u,r,i;if(t){for(console.log(t),u=0,t.sort(function(n,t){return moment(n.Approval_date).valueOf()-moment(t.Approval_date).valueOf()}),console.log(t),r=0;r<t.length;r++)i=t[r],f.dateToIso(i.Approval_date,i,"Approval_date",!0),f.dateToIso(i.Termination_date,i,"Termination_date",!0),i.Amendment_label=i.Amendment_number?"Amendment "+i.Amendment_number:"Original Authorization",i.Amendment_label=i.Termination_date?i.Amendment_label+" (Terminated "+i.view_Termination_date+")":i.Amendment_label+" ("+i.view_Approval_date+")",i.weight=r,console.log(r);return n.mappedAmendments=t,n.selectedPiAuth=n.mappedAmendments[t.length-1],n.selectedAmendment=t.length-1,n.selectedAmendment}};n.openAuthModal=function(t,i,r){var f={},o;f.pi=n.pi;i&&(f[i.Class]=i);r&&(f[r.Class]=r);e.setModalData(f);o=u.open({templateUrl:t+".html",controller:"PiDetailModalCtrl"})};n.openWipeTestModal=function(t){var i={},r;i.pi=n.pi;i.Parcel=t;e.setModalData(i);r=u.open({templateUrl:"views/admin/admin-modals/package-wipe-test.html",controller:"WipeTestModalCtrl"})};n.markAsArrived=function(n,t){var i=new window.Parcel;angular.extend(i,t);i.Status=Constants.PARCEL.STATUS.DELIVERED;i.Arrival_date=f.setMysqlTime(new Date);e.saveParcel(i,t,n)};n.reopenAuth=function(t){var i=new window.PIAuthorization,r;for(angular.extend(i,t),i.Termination_date=null,r=0;r<i.Authorizations;r++)i.Authorizations[r].Is_active=!0;e.savePIAuthorization(i,t,n.pi)}}).controller("PiDetailModalCtrl",["$scope","$rootScope","$modalInstance","actionFunctionsFactory","convenienceMethods",function(n,t,i,r,u){var f=r,e;n.af=f;n.modalData=f.getModalData();n.modalData.PurchaseOrderCopy||(n.modalData.PurchaseOrderCopy={Class:"PurchaseOrder",Principal_investigator_id:n.modalData.pi.Key_id,Purchase_order_number:null,Is_active:!0});n.modalData.ParcelCopy||(n.modalData.ParcelCopy={Class:"Parcel",Purchase_order:null,Purchase_order_id:null,Status:"Ordered",Isotope:null,Isotope_id:null,Arrival_date:null,Is_active:!0,Principal_investigator_id:n.modalData.pi.Key_id});n.modalData.PIAuthorizationCopy||(n.modalData.PIAuthorizationCopy={Class:"PIAuthorization",Rooms:[],Authorization_number:null,Is_active:!0,Principal_investigator_id:n.modalData.pi.Key_id,Authorizations:[]});n.getApprovalDate=function(n,t){return t?"":n.view_Approval_date};n.modalData.AuthorizationCopy||(n.modalData.AuthorizationCopy={Class:"Authorization",Principal_investigator_id:n.modalData.pi.Key_id,Isotope:{},Isotope_id:null,Is_active:!0,Pi_authorization_id:n.modalData.PIAuthorizationCopy?n.modalData.PIAuthorizationCopy.Key_id:null});n.modalData.SolidsContainerCopy||(n.modalData.SolidsContainerCopy={Class:"SolidsContainer",Room_id:null,Principal_investigator_id:n.modalData.pi.Key_id,Is_active:!0});e=f.getAllIsotopes().then(function(){n.isotopes=f.getCachedCollection("Isotope")},function(){t.error="There was a problem retrieving the list of all isotopes.  Please check your internet connection and try again."});n.getTerminationDate=function(n){n.Termination_date&&(n.Form_Termination_date=u.dateToIso(n.Termination_date))};n.carboys=f.getCachedCollection("CarboyUseCycle");n.selectIsotope=function(t){t.Isotope=dataStoreManager.getById("Isotope",t.Isotope_id);n.modalData.AuthorizationCopy&&n.modalData.AuthorizationCopy.Isotope&&(n.modalData.AuthorizationCopy.Isotope_id=n.modalData.AuthorizationCopy.Isotope.Key_id,n.modalData.ParcelCopy&&n.modalData.ParcelCopy.Isotope&&(n.modalData.ParcelCopy.Isotope_id=n.modalData.ParcelCopy.Isotope.Key_id))};n.selectPO=function(){n.modalData.ParcelCopy&&(n.modalData.ParcelCopy.PurchaseOrderrder=dataStoreManager.getById("PurchaseOrder",n.modalData.ParcelCopy.Purchase_order_id))};n.selectAuth=function(){n.modalData.ParcelCopy&&(n.modalData.ParcelCopy.Authorization=dataStoreManager.getById("Authorization",n.modalData.ParcelCopy.Authorization_id))};n.addIsotope=function(t){var i=new Authorization;i.Class="Authorization";i.Pi_authorization_id=t;i.Is_active=i.isIncluded=!0;i.Isotope=new Isotope;i.Isotope.Class="Isotope";n.modalData.PIAuthorizationCopy.Authorizations.push(i)};n.close=function(n){var t,r;if(f.deleteModalData(),n)for(t=n.Authorizations.length;t--;)r=n.Authorizations[t],r.Key_id||n.Authorizations.splice(t,1);i.dismiss()};n.savePIAuthorization=function(t,r,e){var s=n.modalData.pi,o;if(n.modalData.isAmendment&&(t.Key_id=null),t.Approval_date=u.setMysqlTime(u.getDate(t.view_Approval_date)),e)for(t.Is_active=!1,t.Termination_date=u.setMysqlTime(u.getDate(t.Form_Termination_date)),o=0;o<t.Authorizations;o++)t.Authorizations[o].Is_active=!1;else for(o=0;o<t.Authorizations;o++)e||t.Authorizations[o].isIncluded||t.Authorizations.splice(o,1);f.savePIAuthorization(t,r,s).then(function(){i.close();f.deleteModalData()})};n.saveAuthorization=function(n,t,r){t.Pi_authorization_id=t.Pi_authorization_id||pi.Pi_authorization.Key_id;i.dismiss();f.deleteModalData();f.saveAuthorization(n,t,r)};n.saveParcel=function(n,t,r){i.dismiss();f.deleteModalData();f.saveParcel(n,t,r)};n.savePO=function(n,t,r){i.dismiss();f.deleteModalData();f.savePurchaseOrder(n,t,r)};n.saveContainer=function(n,t,r){i.dismiss();f.deleteModalData();f.saveSolidsContainer(n,t,r)};n.saveCarboy=function(n,t,r){i.dismiss();f.deleteModalData();f.saveCarboy(n,t,r)};n.markAsArrived=function(t,i,r){i.Status=Constants.PARCEL.STATUS.ARRIVED;i.Arrival_date=u.setMysqlTime(new Date);n.saveParcel(t,i,r)};n.addCarboyToLab=function(n,t){console.log(n);n.Is_active=!1;i.dismiss();var r={Class:"CarboyUseCycle",Room_id:n.Room.Key_id,Principal_investigator_id:t.Key_id,Key_id:n.Key_id||null,Carboy_id:n.Carboy_id};console.log(r);f.deleteModalData();f.addCarboyToLab(r,t)};n.roomIsAuthorized=function(n,t){if(n.isAuthorized=!1,t.Rooms||!t.Key_id){if(t.Rooms){for(var i=t.Rooms.length;i--;)if(t.Rooms[i].Key_id==n.Key_id)return!0;return!1}return!0}};n.departmentIsAuthorized=function(n,t){if(n.isAuthorized=!1,t.Departments||!t.Key_id){if(t.Departments){for(var i=t.Departments.length;i--;)if(t.Departments[i].Key_id==n.Key_id)return!0;return!1}return!0}};n.getSuggestedAmendmentNumber=function(){n.suggestedAmendmentNumber;var t=n.modalData.PIAuthorizationCopy.Authorizations.length,i=!1;if(t>1){while(t--)if(!n.modalData.PIAuthorizationCopy.Authorizations[t]){i=!0;break}n.suggestedAmendmentNumber=i?t:n.modalData.PIAuthorizationCopy.Authorizations.length}else n.suggestedAmendmentNumber=n.modalData.PIAuthorizationCopy.Authorizations.length;return n.suggestedAmendmentNumber}}]);angular.module("00RsmsAngularOrmApp").controller("RadminMainCtrl",function(n,t,i,r){var u=i;n.af=u;n.$state=r;u.getRadModels().then(function(){var i=dataStoreManager.get("PrincipalInvestigator"),t,r;for(console.log(dataStore),n.typeAheadPis=[],t=i.length;t--;)i[t].User&&(r={Key_id:i[t].Key_id,User:{Name:i[t].User.Name,Key_id:i[t].Key_id}}),n.typeAheadPis.push(r)});n.onSelectPi=function(n){r.go("radmin.pi-detail",{pi:n.Key_id})}});angular.module("00RsmsAngularOrmApp").controller("RadminParentCtrl",function(){alert("in contorller")});angular.module("00RsmsAngularOrmApp").controller("TransferCtrl",function(n,t,i,r,u,f){var e=t;n.af=e;n.dsm=dataStoreManager;n.modalData=e.getRadModels();var o=function(){return e.getAllParcels().then(function(){return dataStore.Parcel.forEach(function(n){n.loadAuthorization()}),n.parcels=dataStore.Parcel})},s=function(){return e.getAllPIs().then(function(){return n.pis=dataStore.PrincipalInvestigator})},h=function(){return e.getAllParcelUses().then(function(){return n.uses=dataStore.ParcelUse})},c=function(){return e.getAllPIAuthorizations().then(function(){return n.auths=dataStore.PIAuthorization})};n.loading=s().then(h).then(c).then(o);n.openTransferInModal=function(n){var t,i;console.log(n);t={};n?(t.Parcel=n,t.pi=dataStoreManager.getById("PrincipalInvestigator",n.Principal_investigator_id)):t.Parcel={Class:"Parcel"};e.setModalData(t);i=f.open({templateUrl:"views/admin/admin-modals/transfer-in-modal.html",controller:"TransferModalCtrl"})};n.openTransferInventoryModal=function(n){var t,i;console.log(n);t={};n?(t.Parcel=n,t.pi=dataStoreManager.getById("PrincipalInvestigator",n.Principal_investigator_id)):t.Parcel={Class:"Parcel"};t.Parcel.Is_active=!0;t.Parcel.Status=Constants.PARCEL.STATUS.DELIVERED;console.log(t);e.setModalData(t);i=f.open({templateUrl:"views/admin/admin-modals/transfer-inventory-modal.html",controller:"TransferModalCtrl"})};n.openTransferOutModal=function(n){var t,i,r,u,o;console.log(n);t={};n?n.Parcel_id&&(i=dataStoreManager.getById("Parcel",n.Parcel_id),i&&(r=dataStoreManager.getById("Authorization",i.Authorization_id)),r&&(u=dataStoreManager.getById("PIAuthorization",r.Pi_authorization_id)),u&&(t.pi=dataStoreManager.getById("PrincipalInvestigator",u.Principal_investigator_id)),t.pi.loadActiveParcels().then(function(){t.ParcelUse=n;e.setModalData(t);var i=f.open({templateUrl:"views/admin/admin-modals/transfer-out-modal.html",controller:"TransferModalCtrl"})})):(t.ParcelUse={Class:"ParcelUse"},e.setModalData(t),o=f.open({templateUrl:"views/admin/admin-modals/transfer-out-modal.html",controller:"TransferModalCtrl"}))};n.openTransferBetweenModal=function(n){var t,i,r,u,n,o;console.log(n);t={};t.transferBetween=!0;n?(n.Destination_parcel_id||(n.DestinationParcel=new Parcel,n.DestinationParcel.Class="Parcel"),n.Parcel_id&&(i=dataStoreManager.getById("Parcel",n.Parcel_id),i&&(r=dataStoreManager.getById("Authorization",i.Authorization_id)),r&&(u=dataStoreManager.getById("PIAuthorization",r.Pi_authorization_id)),u&&(t.pi=dataStoreManager.getById("PrincipalInvestigator",u.Principal_investigator_id)),t.pi.loadActiveParcels().then(function(){t.ParcelUse=n;e.setModalData(t);var i=f.open({templateUrl:"views/admin/admin-modals/transfer-between-modal.html",controller:"TransferModalCtrl"})}))):(t.ParcelUse={Class:"ParcelUse"},n=t.ParcelUse,n.DestinationParcel=new Parcel,n.DestinationParcel.Class="Parcel",e.setModalData(t),o=f.open({templateUrl:"views/admin/admin-modals/transfer-between-modal.html",controller:"TransferModalCtrl"}))}}).controller("TransferModalCtrl",["$scope","$rootScope","$modalInstance","actionFunctionsFactory","convenienceMethods","modelInflatorFactory",function(n,t,i,r,u){var f=r;n.af=f;n.dataStore=dataStore;n.dsm=dataStoreManager;n.modalData=f.getModalData();console.log(n.modalData);n.cv=u;n.onSelectPi=function(t){t.loadPIAuthorizations();t.loadActiveParcels();n.modalData.PI=t};n.getHighestAuth=function(n){if(n&&n.Pi_authorization&&n.Pi_authorization.length){var t=_.sortBy(n.Pi_authorization,[function(n){return moment(n.Approval_date).valueOf()}]);return t[t.length-1]}};n.saveTransferIn=function(t,i){console.log(i);t.Transfer_in_date=u.setMysqlTime(f.getDate(t.view_Transfer_in_date));f.saveParcel(t,i,n.modalData.PI).then(n.close)};n.saveTransferOut=function(t,i,r){if(n.modalData.tooMuch=!1,i.Quantity>t.Remainder){n.modalData.tooMuch="You can't transfer that much.";return}t.loadUses().then(function(){var e=new ParcelUseAmount;e.Parcel_use_id=i.Key_id||null;i.ParcelUseAmounts&&i.ParcelUseAmounts.length&&(e.Key_id=i.ParcelUseAmounts[0].Key_id||null,e.Comments=i.ParcelUseAmounts[0].Comments);e.Class="ParcelUseAmount";e.Curie_level=i.Quantity;e.Waste_type_id=Constants.WASTE_TYPE.TRANSFER;i.ParcelUseAmounts=[e];i.Date_transferred=u.setMysqlTime(i.view_Date_transferred);console.log(i);r.Key_id||(r=!1);n.saving=f.saveParcelUse(t,i,r).then(n.close)})};n.selectReceivingPi=function(t){n.loading=t.loadPIAuthorizations().then(function(){return console.log(t),n.auths=n.getHighestAuth(t),console.log(n.auths),n.auths})};n.getReceivingPi=function(t){var i=dataStoreManager.getById("PrincipalInvestigator",t.DestinationParcel.Principal_investigator_id);return n.selectReceivingPi(i),i};n.saveTransferBetween=function(t,i,r){if(n.modalData.tooMuch=!1,i.Quantity>t.Remainder){n.modalData.tooMuch="You can't transfer that much.";return}var e=dataStoreManager.get("Parcel");(n.rsError=!1,e.forEach(function(t){t.Rs_number==i.DestinationParcel.Rs_number&&(n.rsError=!0)}),n.rsError)||t.loadUses().then(function(){var e=new ParcelUseAmount;e.Parcel_use_id=i.Key_id||null;i.ParcelUseAmounts&&i.ParcelUseAmounts.length&&(e.Key_id=i.ParcelUseAmounts[0].Key_id||null,e.Comments=i.ParcelUseAmounts[0].Comments);e.Class="ParcelUseAmount";e.Curie_level=i.Quantity;e.Waste_type_id=Constants.WASTE_TYPE.TRANSFER;i.ParcelUseAmounts=[e];i.Date_transferred=u.setMysqlTime(i.view_Date_transferred);i.DestinationParcel.Transfer_in_date=u.setMysqlTime(i.view_Date_transferred);console.log(i);r.Key_id||(r=!1);n.saving=f.saveParcelUse(t,i,r).then(n.close)})};n.getTransferNumberSuggestion=function(n){console.log(n);var i=dataStoreManager.get("Parcel"),t=0;return i.forEach(function(i){if(i.Rs_number.indexOf(n)!=-1){console.log(i.Rs_number.substring(2));var r=parseInt(i.Rs_number.substring(2));r>t&&(t=r)}}),t+1};n.close=function(){f.deleteModalData();i.dismiss()}}]);angular.module("00RsmsAngularOrmApp").controller("WipeTestController",function(n,t,i,r,u,f){var e=t,o,s;n.af=e;n.modalData=e.getModalData();o=function(){return e.getAllParcels().then(function(n){for(var t=n.length;t--;)n[t].loadPrincipalInvestigator();return u.parcels=dataStore.Parcel,n})};s=function(){return e.getAllMiscellaneousWipeTests().then(function(){dataStore.MiscellaneousWipeTest||(dataStore.MiscellaneousWipeTest=[]);u.miscellaneousWipeTests=dataStore.MiscellaneousWipeTest})};o().then(s);n.editParcelWipeTest=function(n,t){u.ParcelWipeTestCopy={};t?e.createCopy(t):(u.ParcelWipeTestCopy=new window.ParcelWipeTest,u.ParcelWipeTestCopy.Parcel_id=n.Key_id,u.ParcelWipeTestCopy.Class="ParcelWipeTest",u.ParcelWipeTestCopy.Is_active=!0);n.Creating_wipe=!0};n.cancelParcelWipeTestEdit=function(n){n.Creating_wipe=!1;u.ParcelWipeTestCopy={}};n.editWipeParcelWipe=function(n,t){u.ParcelWipeCopy={};n.Parcel_wipes||(n.Parcel_wipes=[]);for(var i=n.Parcel_wipes.length;i--;)n.Parcel_wipes[i].edit=!1;t?(t.edit=!0,e.createCopy(t)):(u.ParcelWipeCopy=new window.ParcelWipe,u.ParcelWipeCopy.Parcel_wipe_test_id=n.Key_id,u.ParcelWipeCopy.Class="ParcelWipe",u.ParcelWipeCopy.edit=!0,u.ParcelWipeCopy.Is_active=!0,n.Parcel_wipes.unshift(u.ParcelWipeCopy))};n.addMiscWipes=function(n){var i,t;for(n.Miscellaneous_wipes||(n.Miscellaneous_wipes=[]),i=10;i--;)t=new window.MiscellaneousWipe,t.Miscellaneous_wipe_test_id=n.Key_id,t.Class="MiscellaneousWipe",t.edit=!0,n.Miscellaneous_wipes.push(t);n.adding=!0};n.cancelParcelWipeEdit=function(n,t){n.edit=!1;u.ParcelWipeCopy={};for(var i=t.Parcel_wipes.length;i--;)t.Parcel_wipes[i].Key_id||t.Parcel_wipes.splice(i,1)};n.clouseOutMWT=function(n){e.createCopy(n);u.MiscellaneousWipeTestCopy.Closeout_date=i.setMysqlTime(new Date);e.saveMiscellaneousWipeTest(u.MiscellaneousWipeTestCopy)};n.cancelMiscWipeTestEdit=function(){n.Creating_wipe=!1;u.ParcelWipeTestCopy={}};n.editMiscWipe=function(n,t){u.MiscellaneousWipeCopy={};n.Miscellaneous_wipes||(n.Miscellaneous_wipes=[]);for(var i=n.Miscellaneous_wipes.length;i--;)n.Miscellaneous_wipes[i].edit=!1;t?(t.edit=!0,e.createCopy(t)):(u.MiscellaneousWipeCopy=new window.MiscellaneousWipe,u.MiscellaneousWipeCopy.Class="MiscellaneousWipe",u.MiscellaneousWipeCopy.Is_active=!0,u.MiscellaneousWipeCopy.miscellaneous_wipe_test_id=n.Key_id,u.MiscellaneousWipeCopy.edit=!0,n.Miscellaneous_wipes.unshift(u.MiscellaneousWipeCopy))};n.cancelMiscWipeEdit=function(n,t){t.edit=!1;u.MiscellaneousWipeCopy={};for(var i=n.Miscellaneous_wipes.length;i--;)n.Miscellaneous_wipes[i].Key_id||(console.log(),n.Miscellaneous_wipes.splice(i,1))};n.parcelWipeLocations=["Background","Outside","Inside","Bag","Styrofoam","Cylinder","Vial","Lead Pig"];n.openModal=function(n){var t,i;console.log(n);t={};n&&(t[n.Class]=n);e.setModalData(t);i=f.open({templateUrl:"views/admin/admin-modals/misc-wipe-modal.html",controller:"MiscellaneousWipeTestCtrl"})}}).controller("MiscellaneousWipeTestCtrl",["$scope","$rootScope","$modalInstance","actionFunctionsFactory","convenienceMethods",function(n,t,i,r){var u=r;n.af=u;n.modalData=u.getModalData();console.log(n.modalData);n.modalData.MiscellaneousWipeTest||(n.modalData.MiscellaneousWipeTest=new window.MiscellaneousWipeTest,n.modalData.MiscellaneousWipeTest.Class="MiscellaneousWipeTest",n.modalData.MiscellaneousWipeTest.Is_active=!0);n.save=function(t){u.saveMiscellaneousWipeTest(t).then(n.close)};n.close=function(){u.deleteModalData();i.dismiss()}}]).controller("WipeTestModalCtrl",["$scope","$rootScope","$modalInstance","actionFunctionsFactory","convenienceMethods","modelInflatorFactory",function(n,t,i,r,u,f){var e=r;n.af=e;n.modalData=e.getModalData();n.editParcelWipeTest=function(n,t,i){var u,r,i;if(n.Wipe_test&&n.Wipe_test.length)console.log(n),e.createCopy(n.Wipe_test[0]);else{for(n.Wipe_test=[f.instantiateObjectFromJson(new window.ParcelWipeTest)],n.Wipe_test[0].parcel_id=n.Key_id,n.Wipe_test[0].Class="ParcelWipeTest",n.Wipe_test[0].edit=!0,n.Wipe_test[0].Parcel_wipes=[],u=0;u<7;u++)r=new window.ParcelWipe,r.Parcel_wipe_test_id=n.Key_id?n.Key:null,r.Rading_type="LSC",r.edit=!0,r.Class="ParcelWipe",u==0&&(r.Location="Background"),n.Wipe_test[0].Parcel_wipes.push(r);i||(i=!0)}i&&(t.Creating_wipe=!0)};n.editParcelWipeTest(n.modalData.ParcelCopy,n.modalData.Parcel);n.cancelParcelWipeTestEdit=function(n){n.Creating_wipe=!1;t.ParcelWipeTestCopy={}};n.editWipeParcelWipe=function(n,i){t.ParcelWipeCopy={};n.Parcel_wipes||(n.Parcel_wipes=[]);for(var r=n.Parcel_wipes.length;r--;)n.Parcel_wipes[r].edit=!1;i?(i.edit=!0,e.createCopy(i)):(e.getModalData().Wipe_test=new window.ParcelWipe,e.getModalData().Wipe_test.Parcel_wipe_test_id=n.Key_id,e.getModalData().Wipe_test.Class="ParcelWipe",e.getModalData().Wipe_test.edit=!0,e.getModalData().Wipe_test.Is_active=!0)};n.addMiscWipes=function(n){var i,t;for(n.Miscellaneous_wipes||(n.Miscellaneous_wipes=[]),i=10;i--;)t=new window.MiscellaneousWipe,t.Miscellaneous_wipe_test_id=n.Key_id,t.Class="MiscellaneousWipe",t.edit=!0,n.Miscellaneous_wipes.push(t);n.adding=!0};n.cancelParcelWipeEdit=function(n,i){n.edit=!1;t.ParcelWipeCopy={};for(var r=i.Parcel_wipes.length;r--;)i.Parcel_wipes[r].Key_id||i.Parcel_wipes.splice(r,1)};n.onClick=function(){alert("wrong ctrl")};n.parcelWipeLocations=[{Name:"Background"},{Name:"Outside"},{Name:"Inside"},{Name:"Bag"},{Name:"Styrofoam"},{Name:"Cylinder"},{Name:"Vial"},{Name:"Lead Pig"}];n.setLocation=function(t){if(t.Location)for(var i=n.parcelWipeLocations.length;i--;)if(t.Location==n.parcelWipeLocations.Name){t.DropLocation=n.parcelWipeLocations[i];n.$apply();break}console.log(t)};n.save=function(t){e.saveParcelWipeTest(t).then(n.close)};n.close=function(){n.modalData.Parcel.Creating_wipe=!1;e.deleteModalData();i.dismiss()}}]);