function buildingHubController(n,t,i,r,u,f,e){function h(){n.newRoom=!1;e.getData("../../ajaxaction.php?action=getAllBuildings&callback=JSON_CALLBACK",c,o)}function c(t){n.error="";n.Buildings=t;n.building=!1;f.search().building&&angular.forEach(n.Buildings,function(t){t.Key_id===f.search().building&&(n.building=t,n.selectedBuilding=t)})}function o(){n.error="There was a problem retrieving the list of all the buildings in the system.  Please check your internet connection and try again."}function l(t){n.bioHazards=[];n.chemicalHazards=[];n.radHazards=[];angular.forEach(t,function(t){console.log(t.ParentIds);t.ParentIds.indexOf("1")>-1&&(console.log(t),n.bioHazards.push(t))})}function a(){}function y(t){n.newBuilding&&(n.newBuilding.IsDirty=!1);n.buildingCopy&&(n.buildingCopy.IsDirty=!1);n.building={};n.building=angular.copy(t)}function p(){n.newBuilding&&(n.newBuilding.IsDirty=!1);n.buildingCopy&&(n.buildingCopy.IsDirty=!1);alert("There was an error when the system tried to save the building.")}function w(t){n.building.Rooms.push(t)}function s(t){n.error=t?t.Message:"Something went wrong when the system tried to save the room."}n.users=[];h();n.onSelectBuilding=function(t){n.building=t;f.search({building:t.Key_id})};n.onSelectRoom=function(t){n.room=t;var i="../../ajaxaction.php?action=getHazardsInRoom&roomId="+t.Key_id+"&subHazards=false&callback=JSON_CALLBACK";e.getData(i,l,a)};n.showCreateBuilding=function(){n.showAdmin=!n.showAdmin;n.building&&(n.newBuilding=n.building)};n.createBuilding=function(t){var i,r;n.newBuilding&&(i=n.newBuilding.Name,n.newBuilding.IsDirty=!0);n.buildingCopy&&(i=n.buildingCopy.Name,n.buildingCopy.IsDirty=!0);buildingDto={Class:"Building",Name:i,Is_active:1};building=n.building?n.building:buildingDto;t&&(buildingDto.Key_id=n.building.Key_id);r="../../ajaxaction.php?action=saveBuilding";e.updateObject(buildingDto,building,y,p,r)};n.reveal=function(t){angular.forEach(n.buildings,function(n){n.showChildren=!1});t.showChildren=!0};n.deactivateBuilding=function(){};n.editBuilding=function(t){t.edit=!0;n.buildingCopy=angular.copy(t)};n.cancelEditBuilding=function(t){t.edit=!1;n.buildingCopy={}};n.editRoom=function(t){t.edit=!0;n.roomCopy=angular.copy(t)};n.cancelEditRoom=function(t){t.edit=!1;n.roomCopy={}};n.saveEditedRoom=function(t){console.log(n.roomCopy);n.roomCopy.IsDirty=!0;e.updateObject(n.roomCopy,n.building,b,s,"../../ajaxaction.php?action=saveRoom",t)};n.createRoom=function(){roomDTO={Name:n.roomCopy.Name,PIs:[],isNew:!0,Class:"Room",Building_id:n.building.Key_id};e.updateObject(roomDTO,n.building,w,s,"../../ajaxaction.php?action=saveRoom")};var b=function(t){if(n.roomDTO&&(room=angular.copy(n.roomDTO)),n.roomCopy&&(room=n.roomCopy),room.isNew=!1,room.edit=!1,room.IsDirty=!1,n.building.Rooms.shift(),e.arrayContainsObject(n.building.Rooms,room)){var i=e.arrayContainsObject(n.building.Rooms,room,null,!0);room=angular.copy(t);n.roomCopy={}}else n.building.Rooms.unshift(room),n.newRoom=!1};onFailAddRoom=function(n){alert("There was a problem when saving "+n)};n.removeRoomFromBuilding=function(){};n.addPItoRoom=function(t){n.piDTO={KeyId:null,Hazards:[],isNew:!0,Class:"PI"};t.PIs.unshift(n.piDTO)};n.saveNewPI=function(t,i){console.log(i);n.piDTO.Name=i.Name;e.updateObject(n.piDTO,t,onAddPI,onFailAddPI,"../../ajaxaction.php?action=getAllHazards&callback=JSON_CALLBACK")};onAddPI=function(t,i){console.log(n.piDTO);PI=angular.copy(n.piDTO);PI.isNew=!1;i.PIs.shift();i.PIs.unshift(PI)};onFailAddPI=function(n){alert("There was a problem when saving "+n)};n.removePIfromRoom=function(){};n.setAddNewRoom=function(){console.log("new room");n.newRoom=!0;n.roomCopy={Class:"Room",Building_id:n.building.Key_id,Name:""};n.building.Rooms||(n.building.Rooms=[])};n.cancelNewRoom=function(){n.newRoom=!1}}var buildingHub=angular.module("buildingHub",["ui.bootstrap","convenienceMethodWithRoleBasedModule"]);